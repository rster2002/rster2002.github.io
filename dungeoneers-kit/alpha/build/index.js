var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,o=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&i(e,n,t[n]);if(s)for(var n of s(t))a.call(t,n)&&i(e,n,t[n]);return e},l=(e,s)=>t(e,n(s));import{S as u,i as c,s as h,e as f,t as p,a as g,c as m,b as d,d as y,f as v,g as b,h as $,j as S,k as w,n as j,w as O,l as A,D as E,B as C,Z as x,m as P,o as D,p as L,q as T,r as I,u as R,v as k,x as F,y as _,z as M,A as N,C as U,E as H,F as V,G as W,H as B,I as G,J as z,K as X,L as J,M as Y,N as q,O as K,P as Q,Q as Z,R as ee,T as te,U as ne,V as se}from"./vendor.js";let re;const ae={},ie=function(e,t){if(!t)return e();if(void 0===re){const e=document.createElement("link").relList;re=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in ae)return;ae[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":re,t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise(((e,t)=>{s.addEventListener("load",e),s.addEventListener("error",t)})):void 0}))).then((()=>e()))};function oe(e){let t,n,s,r,a,i,o;return{c(){t=f("main"),n=f("div"),s=f("h1"),r=p("Loading..."),a=g(),i=f("p"),o=p(e[0]),this.h()},l(l){t=m(l,"MAIN",{class:!0});var u=d(t);n=m(u,"DIV",{class:!0});var c=d(n);s=m(c,"H1",{class:!0});var h=d(s);r=y(h,"Loading..."),h.forEach(v),a=b(c),i=m(c,"P",{});var f=d(i);o=y(f,e[0]),f.forEach(v),c.forEach(v),u.forEach(v),this.h()},h(){$(s,"class","svelte-sco403"),$(n,"class","svelte-sco403"),$(t,"class","svelte-sco403")},m(e,l){S(e,t,l),w(t,n),w(n,s),w(s,r),w(n,a),w(n,i),w(i,o)},p:j,i:j,o:j,d(e){e&&v(t)}}}function le(e){let t=["Never split the party.","DM is God, and DM is always right, Do not argu with the DM.","Always check for traps.",'If the DM asks, "Are you sure?" DON\'T DO THE THING!',"REST. You don't know what's out there.","Never plot out loud. God is listening and taking notes.","The skeleton always animates.","If something is too good to be true, it probably is.","For the love of all that's holy, don't go in the water. Or the fog.","Write that down. You won't remember it later, but the DM will.","Tricky lock? Ask the barbarian to open it for you.","Anything is a weapon if you roll high enough.","Loot EVERYTHING.","Never draw the card.","If the item is smarter than you are, it has its own agenda.","The Dragon is never your friend.","Don't het on the boat. The DM has a hoarde of nautical beasties he's never been able to use.","PROTECT THE HEALER!","Talk to people. You never known what you don't know.","Bright enough to share.","Alarming DM Phrases: Are you sure?","Alarming DM Phrases: What's your marching order again?","Alarming DM Phrases: And then you see this iron statue.","Alarming DM Phrases: I need more six sided dice.","Go ahead and pull that lever.","Lets see if your spellbook survived that fireball..."];return[t[Math.floor(Math.random()*t.length)]]}class ue extends u{constructor(e){super(),c(this,e,le,oe,h,{})}}const ce={"/campaign/:campaignId":O({asyncComponent:()=>ie((()=>import("./Campaign.js")),["./build/Campaign.js","./build/Campaign.css","./build/vendor.js","./build/SpellPopup.js","./build/SpellPopup.css","./build/GenericTable.js","./build/GenericTable.css","./build/DatasetGuard.js","./build/DatasetGuard.css","./build/searchResultScores.js"]),loadingComponent:ue}),"/character/:characterId":O({asyncComponent:()=>ie((()=>import("./CharacterSheet.js")),["./build/CharacterSheet.js","./build/CharacterSheet.css","./build/vendor.js","./build/Container.js","./build/Container.css","./build/SpellPopup.js","./build/SpellPopup.css","./build/GenericTable.js","./build/GenericTable.css","./build/DatasetGuard.js","./build/DatasetGuard.css"]),loadingComponent:ue}),"/test":O({asyncComponent:()=>ie((()=>import("./Testing.js")),["./build/Testing.js","./build/Testing.css","./build/vendor.js","./build/GenericTable.js","./build/GenericTable.css"]),loadingComponent:ue}),"/":O({asyncComponent:()=>ie((()=>import("./Index2.js")),["./build/Index2.js","./build/Index2.css","./build/vendor.js","./build/Container.js","./build/Container.css","./build/SpellPopup.js","./build/SpellPopup.css","./build/GenericTable.js","./build/GenericTable.css","./build/searchResultScores.js"]),loadingComponent:ue}),"/*":O({asyncComponent:()=>ie((()=>import("./Index2.js")),["./build/Index2.js","./build/Index2.css","./build/vendor.js","./build/Container.js","./build/Container.css","./build/SpellPopup.js","./build/SpellPopup.css","./build/GenericTable.js","./build/GenericTable.css","./build/searchResultScores.js"]),loadingComponent:ue})};function he(e,t,n){return e.split(t).join(n)}function fe(e){return null===e?e:Array.isArray(e)?function(e){let t=[];for(let n of e)t.push(fe(n));return t}(e):"object"==typeof e?function(e){let t={},n=Object.entries(e);for(let[s,r]of n)t[s]=fe(r);return t}(e):e}function pe(e,t,n=null){!function(e){let t=e;t.get=()=>{let t={};return e.subscribe((e=>{t=e}))(),t},t.refresh=()=>e.set(t.get()),t.getList=()=>Object.values(t.get()),t.set=t=>e.update((e=>t)),t.arrayPush=n=>{let s=t.get();s.push(n),e.set(s)},t.arrayRemove=n=>{let s=t.get(),r=s.indexOf(n);s.splice(r,1),e.set(s)}}(e);let s=e.get();s&&(n=s),t=`alpha-${t}`;let r=localStorage.getItem(t);return r?"object"==typeof n?e.set(JSON.parse(r)):e.set(r):e.set(n),e.delete=()=>localStorage.removeItem(t),function(e,t){e.subscribe((e=>{void 0!==e&&("object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem(t,e))}))}(e,t),e}function ge(e,t){const n=A(t);return pe(n,e,t),n}function me(e,t=null){let n=A(t);return function(e,t,n=null){pe(e,t,n)}(n,e,t),n}const de=ge("datasets",[]),ye=ge("currentDataset","");class ve extends Error{constructor(e,t){super(),this.status=e,this.payload=t}getStatus(){return this.status}getPayload(){return this.payload}}const be=new E("alpha-datasets");async function $e(){let e=ye.get();return e?async function(e){return await be.datasets.where({hash:e}).first()}(e):null}async function Se(e){let t=await async function(e){let t=new C(e),n=new x(t),s=await n.getEntries();return s=s.filter((e=>!e.filename.includes("__MACOSX/"))),await Promise.all(s.map((async e=>{let t=await e.getData(new P);return new File([t],e.filename)})))}(e),n=t.find((e=>"index.json"===e.name));if(!n)throw new ve("noMapFile");let s=JSON.parse(await n.text()),r=function(e){let t;try{t=[e.adventures,e.backgrounds,e.classes,e.conditions,e.fluff,e.items.baseItems,e.items.items,e.languages.scripts,e.languages.languages,e.monsterFluff,e.monsters,e.optionalFeatures,e.races,e.spells,["index"]]}catch(n){throw new ve("invalidMappingEntry")}if(t.some((e=>void 0===e)))throw new ve("missingMappingEntry");return t.flat()}(s).map((e=>`${e}.json`)),a=t.filter((e=>r.includes(e.name))),i=await Promise.all(a.map((e=>e.arrayBuffer()))),o=new Uint8Array(i.reduce(((e,t)=>e+t.byteLength),0)),l=0;for(let p of i)o.set(new Uint8Array(p),l),l=p.byteLength;let u=o.buffer,c=await crypto.subtle.digest("sha-256",u),h=[...new Uint8Array(c)].map((e=>e.toString(16).padStart(2,"0"))).join("");let f=de.get().find((e=>e.hash===h));if(f)throw new ve("hashAlreadyExists",f);await be.datasets.put({hash:h,name:s.name,files:Object.fromEntries(a.map((e=>[e.name,e])))}),de.update((e=>(e.push({name:s.name,version:s.version,hash:h}),1===e.length&&ye.set(h),e)))}async function we(e){let t=de.get(),n=t.indexOf(e);-1!==n&&t.splice(n,1),de.set(t),ye.set(""),await be.datasets.where({hash:e.hash}).delete()}var je,Oe;function Ae(e){return l(o({UA:!1,srd:!1,hash:null,name:"Default Entry",source:null,page:0,dataType:je.Unknown},e),{getDescriptionParts(){return[this.getSourceString()]},getDescription(){return this.getDescriptionParts().join(" â€¢ ")},getSourceString(){return`${this.source} ${this.page}`}})}function Ee(e){return Math.floor((e-10)/2)}function Ce(e){return e>=0?`+${e}`:String(e)}function xe(e){return Ce(Ee(e))}function Pe(e){let t=e.split(""),n=t.shift();return n=n.toUpperCase(),n+t.join("")}be.version(1).stores({datasets:"hash, name, *files"}),(Oe=je||(je={})).Unknown="unknown",Oe.Background="background",Oe.Class="class",Oe.Item="item",Oe.Monster="monster",Oe.Race="race",Oe.Spell="spell",Oe.Adventure="adventure",Oe.Language="language";const De={L:"Lawful",C:"Chaotic",N:"Neutral",G:"Good",E:"Evil",U:"Unaligned",A:"Any alignment"},Le={T:"Tiny",S:"Small",M:"Medium",H:"Huge",L:"Large",G:"Gargantuan"},Te={0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900,11:7200,12:8400,13:1e4,14:11500,15:13e3,16:15e3,17:18e3,18:2e4,19:22e3,20:25e3,21:33e3,22:41e3,23:5e4,24:62e3,30:155e3};function Ie(){const e=[];for(let t of Object.values(it))"environment"in t&&t.environment.forEach((t=>{e.includes(t)||e.push(Pe(t))}));return[...new Set(e)]}function Re(e){return Te[e]}function ke(e){return"1/8"===e?.125:"1/4"===e?.25:"1/2"===e?.5:Number(e)}function Fe(e){return l(o(o({},e),Ae(e)),{getDescriptionParts(){return[this.getCRStringWithoutXP(),`${this.getSizeString()} ${this.getTypeString()}`,this.getAlignmentString(),this.getSourceString()]},getModifiers(){return{str:Ee(this.str),dex:Ee(this.dex),con:Ee(this.con),int:Ee(this.int),wis:Ee(this.wis),cha:Ee(this.cha)}},getHPString(){let{hp:e}=this,{average:t,formula:n}=e;return`${t} (${n})`},getCRString(){let{cr:e}=this;return"string"==typeof e?`${e} (${Re(e)} XP)`:"object"==typeof e?`${e.cr} (${Re(e.cr)} XP), Lair ${e.lair} (${Re(e.lair)} XP)`:void 0},getCRValue(){let{cr:e}=this;return"string"==typeof e?ke(e):"object"==typeof e?(ke(e.cr)+ke(e.lair))/2:void 0},getCRStringWithoutXP(){let{cr:e}=this;return"string"==typeof e?`CR ${e}`:"object"==typeof e?`CR ${e.cr}, Lair CR ${e.lair}`:void 0},getACString(){let{ac:e}=this;return e.map((e=>{if("number"==typeof e)return e;if("object"==typeof e){let t="";return e.from&&(t=`${e.ac} (${e.from.join(", ")})`),e.condition&&(t=`${e.ac} ${e.condition}`),e.braces&&(t=`(${t})`),t}})).join(", ")},getXPValue(){let{cr:e}=this;return"string"==typeof e?Re(e):"object"==typeof e?Re(e.cr):void 0},getSpeedString(){let{speed:e}=this,t=[],n=o({walk:0,fly:0,swim:0,climb:0,burrow:0},e);const s=e=>{let s=n[e];if("object"==typeof s){let{number:n,condition:r}=s;t.push(`${e} ${n} ft. ${r}`)}else s>0&&t.push(`${e} ${s} ft.`)};return t.push(`${n.walk} ft.`),s("fly"),s("swim"),s("climb"),s("burrow"),t.join(", ")},getTypeString(){let{type:e}=this;return"object"==typeof e?void 0!==e.tags?`${e.type} (${e.tags.join(", ")})`:e.swarmSize?`swarm ${Le[e.swarmSize]} ${e.type}s`:"(unset)":e},getSizeString(){let{size:e}=this;if("string"==typeof e)return Le[e]},getAlignmentString(e=this.alignment){let t=[];if("object"==typeof e&&Array.isArray(e))for(let n of e)"string"==typeof n?t.push(De[n]):void 0!==n.chance&&t.push(`${this.getAlignmentString(n.alignment)} (${n.chance}%)`);return t.join(" ").toLowerCase()},getDamageResistancesString(e=this.resistance){return void 0===e?null:e.map((e=>{if("string"==typeof e)return e;if("object"==typeof e){let t=[];return e.resist&&t.push(this.getDamageResistancesString(e.resist)),e.note&&t.push(e.note),t.join(" ")}})).join(", ")},getSavesString(){return this.save?(e=this.save,Object.entries(e).map((([e,t])=>(t=t.replace("+",""),`${Pe(e)} {@check ${t}}`))).join(", ")):"";var e},getSkillsString(e=this.skill){return e?Object.entries(e).sort((([e,t])=>"string"==typeof t?-1:1)).map((([e,t])=>"object"==typeof t&&Array.isArray(t)?t.map((e=>"object"!=typeof e?e:void 0!==e.oneOf?`plus one of the following: ${this.getSkillsString(e.oneOf)}`:void 0)):`${e} {@check ${t}}`)).join(", "):""}})}var _e,Me,Ne,Ue,He,Ve;Fe.getCreaturesBySource=function(e){let t=Object.values(it);return e?t.filter((t=>t.source===e)):t},Fe.getMonsterByNameAndSource=function(e,t){let n=Fe.getCreaturesBySource(t);for(let s of n){if(s.name.toLowerCase()===e.toLowerCase())return s}return null},(Me=_e||(_e={})).Strength="str",Me.Dexterity="dex",Me.Constitution="con",Me.Intelligence="int",Me.Wisdom="wis",Me.Charisma="cha",(Ue=Ne||(Ne={}))[Ue.Tiny=0]="Tiny",Ue[Ue.Small=1]="Small",Ue[Ue.Medium=2]="Medium",Ue[Ue.Huge=3]="Huge",Ue[Ue.Large=4]="Large",Ue[Ue.Gargantuan=5]="Gargantuan",(Ve=He||(He={})).LAWFUL_GOOD="lg",Ve.NEUTRAL_GOOD="ng",Ve.CHAOTIC_GOOD="cg",Ve.LAWFUL_NEUTRAL="ln",Ve.TRUE_NEUTRAL="n",Ve.CHAOTIC_NEUTRAL="cn",Ve.LAWFUL_EVIL="le",Ve.NEUTRAL_EVIL="ne",Ve.CHAOTIC_EVIL="ce",Ve.UNALIGNED="u",Ve.ANY="a";const We={H:"heavy",F:"finess",L:"light",T:"throwing",LD:"loading",R:"reach",AF:"firearm",BF:"burstfire",S:"special","2H":"two-handed"},Be={P:"piercing",S:"slashing",B:"bludgeoning"};function Ge(e){let t="baseItem"===e.dataType;return t&&(e.dataType="item"),l(o(o({},e),Ae(e)),{isBaseItem:t,getWeight:()=>e.weight?e.weight:0,isWeapon(){return void 0!==this.weapon&&this.weapon},isWondrous(){return"rarity"in this&&"none"!==this.rarity.toLowerCase()},getProperties(){return this.property||[]},isFiness(){return this.isWeapon()&&this.getProperties().includes("F")},getDescriptionParts(){let e=[];return this.isWeapon()&&e.push(this.getWeaponTypeString()),this.isWondrous()&&(e.push(`Wondrous item, ${this.rarity.toLowerCase()}`),this.reqAttune&&e.push("Attunement")),0===e.length&&e.push("Adventuring Gear"),e.push(this.getSourceString()),e},getAttackBonus(e=null){let t=0;if(!this.isWeapon())return t;if(null!==e&&(this.isFiness()?t+=e.stats.getHighestModifierFrom([_e.Strength,_e.Dexterity]):t+=e.stats.getModifiers().str),void 0!==this.bonus){let e=this.bonus;e=e.replace("+",""),t+=Number(e)}return t},getAttackBonusBreakDown(e=null){let t=[];if(null!==e)if(this.isFiness()){let n=e.stats.getHighestModifierFrom([_e.Strength,_e.Dexterity]);t.push(`${ze(n)}`),t.push(`${n} Str/Dex`)}else{let n=e.stats.getModifiers().str;t.push(`${ze(n)}`),t.push(`${n} Str`)}if(void 0!==this.bonus){let e=this.bonus;e=e.replace("+",""),e=Number(e),t.push(`${ze(e)}`),t.push(`${e} Bonus`)}return t.shift(),t.join(" ")},getDamageExpression(){if(!this.isWeapon())return"0";let e=this.getAttackBonus(),t=ze(e);return e=String(e),e=e.replace("-","- "),`${this.dmg1} ${t} ${e}`},getPropertiesString(){if(!this.isWeapon())return"";return this.getProperties().map((e=>"T"===e?`Throwing (range ${this.range})`:"A"===e?`Ammunition (range ${this.range})`:"V"===e?`Versatile (${this.dmg2})`:"RLD"===e?`Reload (${this.reload} shots)`:Pe(We[e]))).join(", ")},getWeaponTypeString(){if(!this.isWeapon())return"";let e=[];return e.push(Pe(this.weaponCategory)),"M"===this.type?e.push("Melee"):e.push("Ranged"),e.push("Weapon"),e.join(" ")},getWeaponDamageType(){return this.isWeapon()?Be[this.dmgType]:""},isContainer(){var e;return!!(null==(e=null==this?void 0:this.containerCapacity)?void 0:e.weight)}})}function ze(e){return e>=0?"+":""}const Xe={V:"Evocation",N:"Necromancy",A:"Abjuration",D:"Divination",C:"Conjuration",T:"Transmutation",E:"Enchantment",I:"Illusion"};function Je(e){return l(o(o({},e),Ae(e)),{getDescriptionParts(){let e=[];if(this.associatedClass){let t=this.getAssociatedClass();e.push(t.name)}return e.push(this.getLevelString()),e.push(this.getSchoolString()),e.push(this.getBriefSpellComponentsString()),e.push(this.getRangeString()),e.push(this.getSourceString()),e},getAssociatedClass(){return rt[this.associatedClass]},getSchoolString(){let{school:e}=this;return Xe[e]},getLevelString(){let{level:e}=this;return 0===e?"Cantrip":`Level ${e}`},getSpellComponentsString(){let e=this.components,t=Object.keys(e);if(t.includes("m")){let n=t.indexOf("m"),s=e.m;t[n]="string"==typeof s?`Material (${s})`:`Material (${s.text})`}return t=t.map((e=>"s"===e?"Somatic":"v"===e?"Verbal":e)),t.join(", ")},getBriefSpellComponentsString(){return Object.keys(this.components).join(",")},getRangeString(){let{range:e}=this;if("special"===e.type)return"Special";let t=e.distance,{type:n}=t;return"touch"===n?"Touch":"feet"===n?`${t.amount} ft.`:"point"===n?this.getRangeString(t)+" (Point)":"self"===n?"Self":"unlimited"===n?"Unlimited":void 0},getCastingTimeString(){return this.time.map((e=>{let{number:t,unit:n}=e;return`${t} ${n}`})).join(", ")},getDurationString(){return this.duration.map((e=>{let{type:t}=e;if("instant"===t)return"Instantaneous";if("timed"===t){let{duration:{amount:t,type:n}}=e;return e.concentration?`Concentration, Up to ${t} ${n}`:`${t} ${n}`}return"permanent"===t&&e.ends.includes("dispel")?"Until Dispelled":void 0})).join(", ")}})}function Ye(e){return o(o({},e),Ae(e))}const qe={CP:1,SP:10,EL:50,GP:100,PP:1e3},Ke={str:"strength",dex:"dexterity",con:"constitution",int:"intelligence",wis:"wisdom",cha:"charisma"},Qe=Object.fromEntries(Object.entries(Ke).map((([e,t])=>[e,Pe(t)]))),Ze={acrobatics:{basedOn:"dex"},animalHandling:{basedOn:"wis"},arcana:{basedOn:"int"},athletics:{basedOn:"str"},deception:{basedOn:"cha"},history:{basedOn:"int"},insight:{basedOn:"wis"},intimidation:{basedOn:"cha"},investigation:{basedOn:"int"},medicine:{basedOn:"wis"},nature:{basedOn:"int"},perception:{basedOn:"wis"},performance:{basedOn:"cha"},persuasion:{basedOn:"cha"},religion:{basedOn:"int"},slightOfHand:{basedOn:"dex"},stealth:{basedOn:"dex"},survival:{basedOn:"wis"}},et={acrobatics:"Acrobatics",animalHandling:"Animal Handling",arcana:"Arcana",athletics:"Athletics",deception:"Deception",history:"History",insight:"Insight",intimidation:"Intimidation",investigation:"Investigation",medicine:"Medicine",nature:"Nature",perception:"Perception",performance:"Performance",persuasion:"Persuasion",religion:"Religion",slightOfHand:"Slight of Hand",stealth:"Stealth",survival:"Survival"};function tt(e){return l(o(o({},e),Ae(e)),{getSavingThrowsString(){let e=this.saves,t=[];for(const n of e)t.push(Pe(Ke[n]));return t.join(", ")},getProficiencyString(){let e=this.proficiency;if(!e)return"None";let t=[];for(const n of e)if("string"==typeof n)t.push(n);else if("object"==typeof n){let{choose:{from:e,count:s}}=n,r=e.map((e=>Pe(e)));t.push(`Choose ${s} from ${r.join(", ")}`)}return Pe(t.join(", "))},getFirstSubclassFeatureLevel(){let e=this;for(const t of e.classFeatures)if(t.gainSubclassFeature)return t.level;return 1/0},getSubclass(e){const t=this;for(const n of t.subclasses)if(n.hash===e)return n;return null},getClassFeatures(e=null){let t=this.getSubclass(e),n=this.classFeatures.map((e=>(e.type="class",e)));return null!==t&&(n=n.concat(t.subclassFeatures.map((e=>(e.type="subclass",e))))),n=n.sort(((e,t)=>e.level-t.level)),n}})}["acrobatics","animalHandling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","slightOfHand","stealth","survival"].map((e=>o({skill:e},Ze[e]))),tt.getClass=function(e){if("object"==typeof e)return e;let t=rt[e];return void 0===t?null:t},tt.getSubclass=function(e,t){if(!e||!t)return null;let n=tt.getClass(e);if(null===n)return null;for(const s of n.subclasses)if(s.hash===t)return s;return null},tt.getRefSubclassFeature=function(e){let[t,n,s,r,a,i]=e.split("|"),o=Object.values(rt).find((e=>e.name===n));if(!o)return null;let{subclassFeatureMap:l}=o,u=l[`${r} ${t} ${i}`];return u||null},tt.getRefOptionalFeature=function(e){let[t]=e.split("|"),n=Object.values(yt).find((e=>e.name.includes(t)));return n||null};class nt extends Error{constructor(e,t){super(`Error with status '${e}'`),this.status=e,this.payload=t}getStatus(){return this.status}getPayload(){return this.payload}}const st={},rt={},at={},it={},ot={},lt={},ut={},ct={},ht={},ft={},pt={},gt={},mt={},dt={},yt={},vt={},bt={};function $t(e){return 0===e?"Cover":e}function St(){return Object.fromEntries(Object.values(ft).map((e=>[e.name,e])))}let wt,jt=null;function Ot(e){for(let t of Object.keys(e))delete e[t]}async function At(e){let t=(await $e()).files[e];return t?new Response(t,{status:200}):new Response(null,{status:404})}function Et(e){wt&&wt(e)}const Ct={};function xt(e){return e=he(e=e.toLowerCase()," ","-"),D(e)}function Pt(e){let t=function(e){let t=e.name+e.dataType;return void 0===e.name?D(JSON.stringify(e)):xt(t)}(e),n=0;for(;void 0!==Ct[t];)n++;return t+=n,Ct[t]=!0,t}async function Dt(e){let t=`${e}.json`,n=await At(t);return await n.json()}async function Lt(e,t,n,s){return function(e,t,n){e=e.map(((s,r)=>(Et(`Mapping ${t} (${r+1}/${e.length})`),s.dataType=t,s.hash=Pt(s),void 0!==s.source&&(void 0===vt[s.source]&&(vt[s.source]={}),void 0!==s.page&&(void 0===vt[s.source][s.page]&&(vt[s.source][s.page]=[]),vt[s.source][s.page].push(s))),s.source&&s.source.includes("UA")?(s.UA=!0,s.name+=" (UA)"):s.UA=!1,n(s))));let s={},r={};for(const i of e)s[i.hash]=i,void 0!==i.source&&(void 0===r[i.source]&&(r[i.source]={}),r[i.source][i.name]=i);let a=e=>{if("_copy"in e){Et(`Copying ${e.hash}`);let{source:t,name:n}=e._copy;if(t in r&&n in r[t]){let i=a(r[t][n]);delete(e=o(o({},i),e))._copy,s[e.hash]=e}}return s[e.hash]};return Object.values(s).forEach(a),s}(function(e,t){return"*"===t?e.flat(1/0):e.map((e=>e[t])).flat(1/0)}(await Promise.all(s),e),t,n)}function Tt(e){return e.map((e=>Dt(e)))}async function It(){return Lt("monster","monster",Fe,Tt(jt.monsters))}async function Rt(){return Lt("spell","spell",Je,Tt(jt.spells))}async function kt(){return Lt("optionalfeature","optionalFeature",Ae,Tt(jt.optionalFeatures))}async function Ft(){return new Promise((e=>{Lt("*","class",tt,Tt(jt.classes)).then((t=>{t=(t=Object.values(t)).map(((e,t)=>{let n={},s={};for(const r of e.classFeature){let e=`${r.className} ${r.name} ${r.level}`;n[e]=r}void 0===e.subclassFeature&&(e.subclassFeature=[]);for(const r of e.subclassFeature){let e=`${r.subclassShortName} ${r.name} ${r.level}`;s[e]=r}return e.class.map((t=>(t.hash=Pt(t),t.dataType="class",t.UA=t.name.includes("UA"),t.classFeatureMap=n,t.subclassFeatureMap=s,t.classFeatures=t.classFeatures.map((e=>{let t=!1;"object"==typeof e&&(t=!!e.gainSubclassFeature,e=e.classFeature);let[s,r,a,i]=e.split("|"),o=n[`${r} ${s} ${i}`];return o.UA=void 0!==o.source&&o.source.includes("UA"),o.hash=xt(`${r} ${s} ${i}`),o.gainSubclassFeature=t,o})).filter((e=>!!e)).sort(((e,t)=>e.level-t.level)),void 0===t.subclasses&&(t.subclasses=[]),void 0===e.subclass&&(e.subclass=[]),t.subclasses=e.subclass.filter((e=>void 0===e._copy)).map((e=>void 0!==e.hash?fe(e):(e.hash=xt(`${t.name} ${e.name} ${e.classSource}`),e.UA=void 0!==e.source&&e.source.includes("UA"),e.subclassFeatures,e.subclassFeatures=e.subclassFeatures.map((n=>{let[r,a,i,o,l,u]=n.split("|"),c=s[`${o} ${r} ${u}`];return c.UA=void 0!==c.source&&c.source.includes("UA"),c.hash=xt(`${t.name} ${e.name} ${r} ${u}`),c})),e))),t=tt(t))))})).flat(1);let n=Object.fromEntries(t.map((e=>[e.hash,e])));e(n)}))}))}async function _t(){return new Promise((e=>{Promise.all([Lt("baseitem","baseItem",Ae,Tt(jt.items.baseItems)),Lt("item","item",Ae,Tt(jt.items.items))]).then((t=>{let n={};for(let e of t){for(let t in e)e[t]=Ge(e[t]);n=o(o({},n),e)}e(n)}))}))}async function Mt(){return new Promise((e=>{Lt("race","race",Ae,Tt(jt.races)).then((t=>{t=function(e){let t={};for(let n of e)t[n.hash]=n;return t}(t=(t=(t=Object.values(t)).map((e=>(e.subraces||(e.subraces=[]),e.subraces=e.subraces.map((t=>(void 0===t.entries&&(t.entries=[]),t.entries.map((n=>("object"==typeof n&&(n.hash=xt(`${e.name} ${t.name} ${n.name}`)),n))),l(o(o({},{name:"Base",entries:[]}),t),{hash:Pt(t)})))),void 0===e.entries&&(e.entries=[]),e.entries.map((t=>("object"==typeof t&&(t.hash=xt(`${e.name} ${t.name}`)),t))),e)))).map((e=>{return o(o({},t=e),Ae(t));var t}))),e(t)}))}))}async function Nt(){return Lt("fluff","fluff",Ae,jt.fluff.map((e=>async function(e){let t=await Dt(e);return{fluff:o({},t)}}(e))))}async function Ut(){return Lt("monsterFluff","monsterFluff",Ae,Tt(jt.monsterFluff))}async function Ht(){return Lt("condition","condition",Ae,Tt(jt.conditions))}async function Vt(){return Lt("background","background",Ae,Tt(jt.backgrounds))}async function Wt(){return Lt("*","adventure",Ae,Tt(jt.adventures))}async function Bt(){return Lt("language","language",Ye,Tt(jt.languages.languages))}async function Gt(){return Lt("languageScript","languageScript",Ae,Tt(jt.languages.scripts))}const zt=ge("spotifyUserToken",""),Xt=ge("spotifyRefreshToken",""),Jt=ge("spotifyLastGrant",0),Yt=A(Zt()),qt=()=>{Yt.set(Zt())};async function Kt(){return(await fetch("./config.json").then((e=>e.json()))).spotify.clientId}async function Qt(){let e=new URLSearchParams(location.search),t=e.get("code");"auth"===e.get("state")&&await async function(e){let t=function(e={}){return Object.entries(e).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&")}({client_id:await Kt(),grant_type:"authorization_code",code:e,redirect_uri:location.origin,code_verifier:sessionStorage.getItem("::spotifyVerifier")}),n=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then((e=>e.json())),s=sessionStorage.getItem("::spotifyReturn");sessionStorage.removeItem("::spotifyReturn"),sessionStorage.removeItem("::spotifyVerifier"),zt.set(n.access_token),Xt.set(n.refresh_token),Jt.set(Date.now()),location.href=s}(t)}function Zt(){return""!==zt.get()&&""!==Xt.get()}function en(e){if(!e)return null;let t=e,n=[],s=1/0,r=-1/0,a=0,i=0;t=t.replace("Ã—","*");let o=L(/\Dd\d+/gm,t);for(const m of o){let e=m.match,n=t.split("");n.shift(),t=n.join(""),t=t.replace(e,"1"+e)}let l,u,c,h=t,f=t,p=t,g=L(/\d+d\d+/gm,t);for(const m of g){let[e,o]=m.match.split("d"),l=[],u=0;for(let t=1;t<=Number(e);t++){let e=Math.floor(Math.random()*Number(o)+1);e>r&&(r=e),e<s&&(s=e),l.push({expression:`1d${o}`,count:1,type:Number(o),result:e}),u+=e,i+=e,a++}n.push({expression:m.match,count:Number(e),type:Number(o),result:u,subResults:l}),t=t.replace(m.match,String(u)),h=h.replace(m.match,`{${u}}`),p=p.replace(m.match,e),f=f.replace(m.match,String(Number(e)*Number(o)))}t=he(t,"min",String(s)),t=he(t,"max",String(r)),p=he(p,"min",String(s)),p=he(p,"max",String(r)),f=he(f,"min",String(s)),f=he(f,"max",String(r)),h=he(h,"min",`{${s}}`),h=he(h,"max",`{${r}}`);try{l=T(t),u=T(p),c=T(f)}catch{return null}return h=he(h," ",""),h=he(h,"+"," + "),h=he(h,"-"," - "),h=he(h,"/"," / "),h=he(h,"*"," * "),h=he(h,"^"," ^ "),{result:l,diceResults:n,diceTotal:i,min:s,max:r,average:l/a,sum:l,resultExpression:h,expression:e,minResult:u,maxResult:c}}zt.subscribe(qt),Xt.subscribe(qt);function tn(e){let t,n,s,r,a,i,o,l,u,c,h,j,O,A,E,C,x,P,D,L,T,M,U=e[0].result+"",H=e[0].expression+"",V=e[0].resultExpression+"";return{c(){t=f("div"),n=f("div"),s=f("h4"),r=p(U),i=g(),o=f("div"),l=g(),u=f("div"),c=f("p"),h=p(H),j=g(),O=f("p"),A=p(V),E=g(),C=f("button"),x=f("span"),this.h()},l(e){t=m(e,"DIV",{class:!0});var a=d(t);n=m(a,"DIV",{class:!0});var f=d(n);s=m(f,"H4",{class:!0});var p=d(s);r=y(p,U),p.forEach(v),f.forEach(v),i=b(a),o=m(a,"DIV",{class:!0}),d(o).forEach(v),l=b(a),u=m(a,"DIV",{class:!0});var g=d(u);c=m(g,"P",{class:!0});var $=d(c);h=y($,H),$.forEach(v),j=b(g),O=m(g,"P",{class:!0});var S=d(O);A=y(S,V),S.forEach(v),g.forEach(v),E=b(a),C=m(a,"BUTTON",{class:!0});var w=d(C);x=m(w,"SPAN",{class:!0}),d(x).forEach(v),w.forEach(v),a.forEach(v),this.h()},h(){$(s,"class",a=(e[1]&&"min")+" "+(e[2]&&"max")+" svelte-1ap9m7g"),$(n,"class","result"),$(o,"class","divider svelte-1ap9m7g"),$(c,"class","expression svelte-1ap9m7g"),$(O,"class","resultExpression svelte-1ap9m7g"),$(u,"class","expression"),$(x,"class","mdi mdi-close-circle-outline"),$(C,"class","svelte-1ap9m7g"),$(t,"class","diceResult svelte-1ap9m7g")},m(a,f){S(a,t,f),w(t,n),w(n,s),w(s,r),w(t,i),w(t,o),w(t,l),w(t,u),w(u,c),w(c,h),w(u,j),w(u,O),w(O,A),w(t,E),w(t,C),w(C,x),L=!0,T||(M=I(C,"click",e[3]),T=!0)},p(e,[t]){(!L||1&t)&&U!==(U=e[0].result+"")&&R(r,U),(!L||6&t&&a!==(a=(e[1]&&"min")+" "+(e[2]&&"max")+" svelte-1ap9m7g"))&&$(s,"class",a),(!L||1&t)&&H!==(H=e[0].expression+"")&&R(h,H),(!L||1&t)&&V!==(V=e[0].resultExpression+"")&&R(A,V)},i(e){L||(k((()=>{D&&D.end(1),P||(P=F(t,N,{x:-200,duration:250})),P.start()})),L=!0)},o(e){P&&P.invalidate(),D=_(t,N,{x:-200,duration:250}),L=!1},d(e){e&&v(t),e&&D&&D.end(),T=!1,M()}}}function nn(e,t,n){let s,r;const a=M();var{result:i}=t;return e.$$set=e=>{"result"in e&&n(0,i=e.result)},e.$$.update=()=>{1&e.$$.dirty&&n(1,s=i.result===i.minResult),1&e.$$.dirty&&n(2,r=i.result===i.maxResult)},[i,s,r,function(){a("close")}]}class sn extends u{constructor(e){super(),c(this,e,nn,tn,h,{result:0})}}function rn(e,t,n){const s=e.slice();return s[6]=t[n],s}function an(e){let t,n,s=[],r=new Map,a=e[0];const i=e=>e[6];for(let o=0;o<a.length;o+=1){let t=rn(e,a,o),n=i(t);r.set(n,s[o]=on(n,t))}return{c(){t=f("div");for(let e=0;e<s.length;e+=1)s[e].c();this.h()},l(e){t=m(e,"DIV",{class:!0});var n=d(t);for(let t=0;t<s.length;t+=1)s[t].l(n);n.forEach(v),this.h()},h(){$(t,"class","floater svelte-14cie1s")},m(e,r){S(e,t,r);for(let n=0;n<s.length;n+=1)s[n].m(t,null);n=!0},p(e,n){3&n&&(a=e[0],U(),s=H(s,n,i,1,e,a,r,t,V,on,null,rn),W())},i(e){if(!n){for(let e=0;e<a.length;e+=1)B(s[e]);n=!0}},o(e){for(let t=0;t<s.length;t+=1)G(s[t]);n=!1},d(e){e&&v(t);for(let t=0;t<s.length;t+=1)s[t].d()}}}function on(e,t){let n,s,r;return s=new sn({props:{result:t[6]}}),s.$on("close",(function(){return t[4](t[6])})),{key:e,first:null,c(){n=z(),J(s.$$.fragment),this.h()},l(e){n=z(),Y(s.$$.fragment,e),this.h()},h(){this.first=n},m(e,t){S(e,n,t),q(s,e,t),r=!0},p(e,n){t=e;const r={};1&n&&(r.result=t[6]),s.$set(r)},i(e){r||(B(s.$$.fragment,e),r=!0)},o(e){G(s.$$.fragment,e),r=!1},d(e){e&&v(n),K(s,e)}}}function ln(e){let t,n,s=e[0].length>0&&an(e);return{c(){s&&s.c(),t=z()},l(e){s&&s.l(e),t=z()},m(e,r){s&&s.m(e,r),S(e,t,r),n=!0},p(e,[n]){e[0].length>0?s?(s.p(e,n),1&n&&B(s,1)):(s=an(e),s.c(),B(s,1),s.m(t.parentNode,t)):s&&(U(),G(s,1,1,(()=>{s=null})),W())},i(e){n||(B(s),n=!0)},o(e){G(s),n=!1},d(e){s&&s.d(e),e&&v(t)}}}function un(e,t,n){var{context:s}=t,{timeout:r=5e3}=t,a=[];function i(e){a.push(e),n(0,a),setTimeout((()=>{o(e)}),r)}function o(e){let t=a.indexOf(e);-1!==t&&(a.splice(t,1),n(0,a))}s.onRoll(i),X((()=>{s.removeListener(i)}));return e.$$set=e=>{"context"in e&&n(2,s=e.context),"timeout"in e&&n(3,r=e.timeout)},[a,o,s,r,e=>o(e)]}class cn extends u{constructor(e){super(),c(this,e,un,ln,h,{context:2,timeout:3})}}function hn(e){let t,n,s,r,a,i,o;return{c(){t=f("div"),n=f("div"),s=f("img"),a=g(),i=f("p"),o=p(e[1]),this.h()},l(r){t=m(r,"DIV",{class:!0});var l=d(t);n=m(l,"DIV",{class:!0});var u=d(n);s=m(u,"IMG",{class:!0,src:!0,alt:!0}),a=b(u),i=m(u,"P",{class:!0});var c=d(i);o=y(c,e[1]),c.forEach(v),u.forEach(v),l.forEach(v),this.h()},h(){$(s,"class","spinner svelte-g34ao9"),s.src!==(r="./img/logo.svg")&&$(s,"src","./img/logo.svg"),$(s,"alt","Dungeoneer's Logo"),$(i,"class","svelte-g34ao9"),$(n,"class","svelte-g34ao9"),$(t,"class","loadingScim svelte-g34ao9")},m(e,r){S(e,t,r),w(t,n),w(n,s),w(n,a),w(n,i),w(i,o)},p(e,t){2&t&&R(o,e[1])},i:j,o:j,d(e){e&&v(t)}}}function fn(e){let t,n,s,r;return t=new cn({props:{context:e[2]}}),s=new se({props:{routes:ce}}),{c(){J(t.$$.fragment),n=g(),J(s.$$.fragment)},l(e){Y(t.$$.fragment,e),n=b(e),Y(s.$$.fragment,e)},m(e,a){q(t,e,a),S(e,n,a),q(s,e,a),r=!0},p:j,i(e){r||(B(t.$$.fragment,e),B(s.$$.fragment,e),r=!0)},o(e){G(t.$$.fragment,e),G(s.$$.fragment,e),r=!1},d(e){K(t,e),e&&v(n),K(s,e)}}}function pn(e){let t,n,s,r,a,i;const o=[fn,hn],l=[];function u(e,t){return e[0]?0:1}return s=u(e),r=l[s]=o[s](e),{c(){t=f("link"),n=g(),r.c(),a=z(),this.h()},l(e){const s=Q('[data-svelte="svelte-vtsmpy"]',document.head);t=m(s,"LINK",{rel:!0,href:!0,class:!0}),s.forEach(v),n=b(e),r.l(e),a=z(),this.h()},h(){$(t,"rel","stylesheet"),$(t,"href","//cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"),$(t,"class","svelte-g34ao9")},m(e,r){w(document.head,t),S(e,n,r),l[s].m(e,r),S(e,a,r),i=!0},p(e,[t]){let n=s;s=u(e),s===n?l[s].p(e,t):(U(),G(l[n],1,1,(()=>{l[n]=null})),W(),r=l[s],r?r.p(e,t):(r=l[s]=o[s](e),r.c()),B(r,1),r.m(a.parentNode,a))},i(e){i||(B(r),i=!0)},o(e){G(r),i=!1},d(e){v(t),e&&v(n),l[s].d(e),e&&v(a)}}}function gn(e,t,n){let s,r;Z(e,ye,(e=>n(3,s=e))),Z(e,ne,(e=>n(4,r=e)));var a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}l((s=s.apply(e,t||[])).next())}))},i=function(){let e=[];return{roll(t){let n=en(t);e.forEach((e=>e(n)))},onRoll(t){console.trace("add",t),e.push(t)},removeListener(t){console.trace("remove",t);let n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}(),o=!1,l="";function u(){return a(this,void 0,void 0,(function*(){n(0,o=!1);try{yield async function(e){if(wt=e,Et("Preparing..."),!(await $e()))throw new nt("noDatasetSelected");let t=await At("index.json");jt=await t.json(),Et("Loading..."),Ot(gt),Ot(mt);const n=async(e,t,n=!0)=>{Ot(e);let s=await t();return Object.assign(e,s),Object.assign(gt,s),n&&Object.assign(mt,s),s};await Promise.all([n(st,Mt),n(rt,Ft),n(at,_t),n(it,It),n(ot,Rt),n(lt,Vt),n(ut,Ht),n(dt,Nt,!1),n(ct,Wt,!1),n(yt,kt,!1),n(ht,Bt),n(pt,Gt,!1),n(ft,Ut,!1)]);for(let s of jt.imageBooks)s.pageMapFunction=$t,bt[s.code]=s;return console.log(gt),console.log("Preloaded"),!0}((e=>{n(1,l=e)})),n(0,o=!0),Qt()}catch(e){"/settings"!==r&&ee("/settings")}finally{n(0,o=!0)}}))}return e.$$.update=()=>{8&e.$$.dirty&&u()},te("diceContext",i),[o,l,i,s]}new class extends u{constructor(e){super(),c(this,e,gn,pn,h,{})}}({target:document.body});export{_e as A,et as B,tt as C,Qe as D,Ae as E,we as F,Se as G,ve as H,Ge as I,Je as S,de as a,me as b,Pe as c,fe as d,ye as e,en as f,Ie as g,ut as h,bt as i,qe as j,Be as k,at as l,it as m,ot as n,St as o,Ce as p,xe as q,Ke as r,mt as s,gt as t,ht as u,Ze as v,rt as w,st as x,lt as y,Ee as z};
