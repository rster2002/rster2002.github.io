var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,o=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&a(e,r,t[r]);if(s)for(var r of s(t))n.call(t,r)&&a(e,r,t[r]);return e},l=(e,s)=>t(e,r(s));import{x as c,w as u,C as g,y as h,A as d,z as p,i as f,r as m,v,B as y,D as b,c as C,l as S,d as I,I as w,S as A,n as j,p as F,E as O,t as x,s as E,b as T,e as P}from"./index.js";import{g as L}from"./SpellPopup.js";import{S as k,i as W,s as M,a4 as R,e as U,a as $,t as D,c as B,b as z,f as H,g as N,d as q,h as V,j as _,k as G,a5 as J,u as K,H as Q,I as X}from"./vendor.js";function Y(e,t){for(let r of t)Z(e,r)}function Z(e,t){for(let[r,s]of Object.entries(t))e[r]+=s;return e}function ee(e,t){return l(o({UA:!1,entries:[],hash:L(),name:"(feature)",type:"custom"},t),{getSourceString(){return void 0===this.source?"":this.source+" "+this.page},addToFeatures(){return e.features.addFeature(this)},removeFromFeatures(){return e.features.removeFeature(this)}})}function te(e){let{characterStore:t}=e;return{getCharacterLevel(){return this.getRaw().reduce(((e,t)=>e+t.level),0)},get(){return this.getRaw().map((({hash:e})=>u[e]))},getSpellCastingClasses(){return this.get().filter((e=>void 0!==e.spellcastingAbility))},getRaw:()=>t.get().classes,getSubclasses(){return this.getRaw().map((({hash:e,subclass:t})=>u[e].getSubclass(t)))},getAllFeatures(){let{UA:r}=t.get().settings;return this.getRaw().map((({hash:e,subclass:t})=>g.getClass(e).getClassFeatures(t))).flat(1).filter((e=>!e.UA||e===r)).map((t=>ee(e,t)))},getAvailableClassFeatures(){let{UA:r}=t.get().settings,s=e.features.getFeatureHashes();return this.getRaw().map((({hash:e,subclass:t,level:r})=>g.getClass(e).getClassFeatures(t).filter((e=>e.level<=r)))).flat(1).filter((e=>!e.UA||e===r)).filter((e=>!s.includes(e.hash))).map((t=>ee(e,t)))},hasClass(e){return"object"==typeof e&&(e=e.hash),this.getRaw().map((({hash:e})=>e)).includes(e)},canChooseClass(t){return 0===this.get().length||("string"==typeof t&&(t=u[t]),[...this.get(),t].map((t=>function(e,t){if(void 0===t.multiclassing)return!1;let r=t.multiclassing.requirements;if(void 0!==r.or){let t=Object.entries(r.or),s=e.stats.get();for(let[e,r]of t)if(s[e]>=r)return!0;return!1}{let t=Object.entries(r),s=e.stats.get();for(let[e,r]of t)if(s[e]<r)return!1;return!0}}(e,t))).every((e=>e)))},addClass(e){return this.getCharacterLevel()+1>20?"levelLimitReached":("object"==typeof e&&(e=e.hash),t.get().classes.push({hash:e,level:1,subclass:""}),t.refresh(),"success")},removeClass(r){"object"==typeof r&&(r=r.hash);let s=this.getRaw().map((({hash:e})=>e)).indexOf(r);return s<0?"classIsNotSelected":(t.get().classes.splice(s,1),t.refresh(),e.spells.removeSpellsFromClass(r),"success")},toggleClass(e){return"object"==typeof e&&(e=e.hash),this.hasClass(e)?this.removeClass(e):this.addClass(e)},getSavingThrowProficiencies(){let e={};return this.get().forEach((t=>{t.proficiency.forEach((t=>e[t]=!0))})),e}}}const re=[d.Strength,d.Dexterity,d.Constitution,d.Intelligence,d.Wisdom,d.Charisma];function se(e,t=[]){return{name:e,overrideEnabled:!1,override:0,bonusEnabled:!1,bonus:0,categories:t}}var ie,ne;(ne=ie||(ie={})).None="none",ne.Proficient="proficient",ne.Expertise="expertise";var ae={version:1.2,id:"qfqef",dataset:null,editing:!1,name:"",settings:{UA:!1,includedSources:Object.keys(f)},classes:[],race:"",subrace:"",background:"",spells:[],spellSlots:{1:{slots:0,used:0},2:{slots:0,used:0},3:{slots:0,used:0},4:{slots:0,used:0},5:{slots:0,used:0},6:{slots:0,used:0},7:{slots:0,used:0},8:{slots:0,used:0},9:{slots:0,used:0}},preparedSpells:[],carriedItems:{name:"Carried items",id:"character",storedItems:[]},inventory:[],attunedItems:[],activeItems:[],additionalActions:[],armorClass:18,speed:30,health:{current:0,max:0,temp:0},abilities:{str:10,dex:10,con:10,int:10,wis:10,cha:10},savingThrows:o({},Object.fromEntries(Object.entries(m).map((([e])=>[e,{proficiency:"none"}])))),skills:o({},Object.fromEntries(Object.entries(v).map((([e])=>[e,{name:y[e],proficiency:"none"}])))),features:[],selectedOptionalFeatures:[],pinnedSubFeatures:[],proficiencies:[],overrides:o({str:se("Strength ability score",["Ability score"]),dex:se("Dexterity ability score",["Ability score"]),con:se("Constitution ability score",["Ability score"]),int:se("Intelligence ability score",["Ability score"]),wis:se("Wisdom ability score",["Ability score"]),cha:se("Charisma ability score",["Ability score"]),maxCarryingCapacity:se("Max carrying capacity",["Misc"]),proficiencyBonus:se("Proficiency bonus",["Misc","Proficiency"]),initiative:se("Initiative",["Combat"]),armorClass:se("Armor Class",["Combat"]),savingStr:se("Strength saving throw",["Saving Throw","Proficiency"]),savingDex:se("Dexterity saving throw",["Saving Throw","Proficiency"]),savingCon:se("Constitution saving throw",["Saving Throw","Proficiency"]),savingInt:se("Intelligence saving throw",["Saving Throw","Proficiency"]),savingWis:se("Wisdom saving throw",["Saving Throw","Proficiency"]),savingCha:se("Charisma saving throw",["Saving Throw","Proficiency"])},Object.fromEntries(Object.entries(v).map((([e])=>[e,se(`${y[e]} skill`,["Skill","Proficiency"])]))))};const oe={str:"savingStr",dex:"savingDex",con:"savingCon",int:"savingInt",wis:"savingWis",cha:"savingCha"},le=["none","proficient"];const ce={animalHandling:"Animal Handling",slightOfHand:"Slight of Hand"},ue=["none","proficient","expertise"];function ge(e,t){return l(o({id:L(),storedItems:[]},e),{getMaxWeight(){return"character"===this.id?t.inventory.getMaxCarryingCapacity():null},getStoredItems(){return this.storedItems.map((e=>t.inventory.getInventoryItem(e)))},getWeight(){return this.getStoredItems().reduce(((e,t)=>e+t.getWeight()),0)},addItemToContainer(e){this.itemCanBeAdded(e)&&(e.currentContainer=this.id,this.storedItems.push(e.id),t.refresh())},removeItemFromContainer(e){let r=this.storedItems.indexOf(e.id);-1!==r&&(this.storedItems.splice(r,1),t.refresh())},itemCanBeAdded(e){var r;let s=this.id!==e.id,i=!this.storedItems.includes(e.id),n={};const a=e=>{e.forEach((e=>{n[e]=!0;let r=t.inventory.getInventoryItem(e);a(r.storedItems)}))};a(e.storedItems);let o=!0;if("character"!==this.id){let t=this;for(;t;){t.getWeight()+e.getWeight()<=t.getMaxWeight()?t=null==(r=t.getCurrentContainer)?void 0:r.call(t):(t=null,o=!1)}}let l=void 0===n[this.id];return s&&o&&i&&l},moveToThisContainer(e){this.itemCanBeAdded(e)&&(e.getCurrentContainer().removeItemFromContainer(e),this.addItemToContainer(e))}})}function he(e,t){const r=ge(e,t),s=w(e);return Object.assign(e,{id:L(),note:"",currentContainer:"character"},s,r,{inContainer(){return"character"!==this.currentContainer&&"void"!==this.currentContainer},getCurrentContainer(){return t.inventory.getContainer(this.currentContainer)},getMaxWeight(){let t=r.getMaxWeight();return this.isContainer()&&null===t?e.containerCapacity.weight[0]:null},getWeight(){var e;let t=s.getWeight();return(null==(e=s.containerCapacity)?void 0:e.weightless)||(t+=r.getWeight()),t},getCapacity:()=>r.getWeight()})}function de(e,t){let r=t.spellcastingAbility,s=e.stats.get()[r],i=p(s),n=i+e.proficiency.get();return{classObject:t,spellCastingAbility:r,score:s,modifier:i,spellAttackModifier:n,spellSaveDC:8+n}}var pe,fe;function me(e,t,r,s,i){return"number"==typeof r&&(r=`${r} ft.`),"number"==typeof s&&(s=F(s)),{name:e,type:t,range:r,modifier:s,onHit:i}}function ve(e,t){let r=Object.entries(e);return r=r.filter((([e,r])=>ye(r,t))),Object.fromEntries(r)}function ye(e,t){let r=void 0!==e.UA&&!(e.UA&&!t.UA),s=e.UA||void 0!==e.source&&t.includedSources.includes(e.source.toLowerCase());return r&&s}function be(e){return l(o(o({},e),O(e)),{getDescriptionParts(){let e=[];this.custom?e.push("Custom"):e.push(`${this.type} proficiency`);let t=this.getEntry();return null!==t&&(e=[...e,...t.getDescriptionParts()]),e},getEntry(){return null===this.hash||void 0===x[this.hash]?null:x[this.hash]}})}(fe=pe||(pe={})).Spell="spell",fe.Weapon="weapon",fe.Unarmed="unarmed";const Ce={customArmor:"armor",customWeapon:"weapon",customTool:"tool",customLanguage:"language"};var Se,Ie;(Ie=Se||(Se={})).Armor="armor",Ie.Weapon="weapon",Ie.Tool="tool",Ie.Language="language",Ie.CustomArmor="customArmor",Ie.CustomWeapon="customWeapon",Ie.CustomTool="customTool",Ie.CustomLanguage="customLanguage";const we=T("charactersList",[]);function Ae(){return we.get().map(Oe)}function je(){let e=L(9),t=we.get();t.push(e),we.set(t),location.href="#/character/"+e}const Fe=new Map;function Oe(e){let t=T(`character_${e}`,ae);t.get().id=e,t.set(function(e){let t=Fe.entries(),{value:r}=t.next();for(;void 0!==r;){let[s,i]=r;e.version<s&&(i(e),e.version=s),r=t.next().value}return e}(t.get())),function(e){let t=we.get();t.includes(e)||(t.push(e),we.set(t))}(e),t.get().dataset||(t.get().dataset=P.get(),t.refresh());let r={characterStore:t,get:()=>t.get(),getId(){return this.get().id},getName(){let e=this.get().name;return e.length>0?e:"(No name)"},getDescription(){let e=this.race.get();e=void 0===e?"(No race)":e.name;let t=this.class.get().map((e=>e.name)).join(" ");return t=t.length>0?t:"(No class)",`${e} ${t}`},getSpeed(){return this.get().speed},getArmorClass(){return this.get().armorClass},prop:(e,t)=>e,delete(){!function(e){let t=we.get(),r=t.indexOf(e);-1!==r&&t.splice(r,1),we.set(t)}(e),t.delete()},refresh(){t.refresh()},subscribe(e){return t.subscribe((t=>{e(this)}))},update(e){t.update(e)}};var s;return r.inventory=function(e){const{characterStore:t}=e;return{getCarriedItems(){let e={};const t=r=>{r.forEach((r=>{e[r]=!0;let s=this.getInventoryItem(r);t(s.storedItems)}))};return t(this.getCarriedContainer().storedItems),Object.keys(e).map((e=>this.getInventoryItem(e)))},getAllContainers(){return[this.getCarriedContainer(),...this.getContainers()]},getContainer(e){if(!e)return null;if("character"===e)return this.getCarriedContainer();let t=this.getInventoryItem(e);return(null==t?void 0:t.isContainer())?t:null},getCarriedContainer:()=>ge(t.get().carriedItems,e),getContainers(){return this.get().filter((e=>e.isContainer()))},get:()=>t.get().inventory.map((t=>he(t,e))),getRawActive:()=>t.get().activeItems,getActive(){return this.get().filter((({id:e})=>this.isItemActive(e)))},getInventoryItem(e){let t=this.get().find((t=>t.id===e));return void 0!==t?t:null},getAttunedItems(){let e=[...t.get().attunedItems];for(;e.length<3;)e.push(null);return e.map((e=>this.getInventoryItem(e)))},isItemActive(e){if("object"==typeof e&&(e=e.id),void 0===e)throw new Error("Expected an item");return this.getRawActive().includes(e)},add(r){if(void 0===r)throw new Error("Argument should be an item or item hash");"string"==typeof r&&(r=S[r]);let s=he(I(r),e);return t.update((e=>(this.getCarriedContainer().addItemToContainer(s),e.inventory.push(s),e))),s},remove(e){if(void 0===e)throw new Error("Argument should be an id or an item object");"object"==typeof e&&(e=e.id);let r=this.get(),s=this.getInventoryItem(e),i=r.findIndex((t=>t.id===e));r.splice(i,1),this.removeAttunementTo(e),s.getCurrentContainer().removeItemFromContainer(s),s.getStoredItems().forEach((e=>{s.getCurrentContainer().moveToThisContainer(e)})),t.update((e=>(e.inventory=r,e)))},update(e){if(void 0===e.id)throw new Error("Expected an item with an id present");let r=this.get();r=r.map((t=>(t.id===e.id&&(t=o(o({},t),e)),t))),t.update((e=>(e.inventory=r,e)))},addItemActive(e){if("object"==typeof e&&(e=e.id),void 0===e)throw new Error("Expected an item");let r=this.getRawActive();r.includes(e)||r.push(e),t.update((e=>(e.activeItems=r,e)))},removeItemActive(e){if("object"==typeof e&&(e=e.id),void 0===e)throw new Error("Expected an item");let r=this.getRawActive();for(let t=0;t<r.length;t++)r[t]===e&&r.splice(t,1);t.update((e=>(e.activeItems=r,e)))},toggleItemActive(e){if("object"==typeof e&&(e=e.id),void 0===e)throw new Error("Expected an item");this.getRawActive().includes(e)?this.removeItemActive(e):this.addItemActive(e)},getCurrentCarryingCapacity(){return this.getCarriedContainer().getStoredItems().reduce(((e,t)=>e+t.getWeight()),0)},getMaxCarryingCapacity:()=>e.overrides.resolve("maxCarryingCapacity",15*e.stats.get().str),attuneToItem(e){let r;r="object"==typeof e?e.id:e;let s=t.get().attunedItems;s.length<3&&!s.includes(r)&&(s.push(r),t.refresh())},removeAttunementTo(e){let r;r="object"==typeof e?e.id:e;let s=t.get().attunedItems,i=s.indexOf(r);-1!==i&&(s.splice(i,1),t.refresh())},toggleAttunementTo(e){let t;t="object"==typeof e?e.id:e,this.isAttunedTo(t)?this.removeAttunementTo(t):this.attuneToItem(t)},canAttuneTo(e){let r;r="object"==typeof e?e:this.getInventoryItem(e);let s=!0===r.reqAttune,i=t.get().attunedItems.filter((e=>null!==e)).length<3;return s&&i},isAttunedTo(e){let r;return r="object"==typeof e?e.id:e,t.get().attunedItems.includes(r)}}}(r),r.settings=function(e){const{characterStore:t}=e;return{get:()=>t.get().settings,getUA:()=>t.get().settings.UA,getIncludedSources:()=>t.get().settings.includedSources,toggleUA(){t.update((e=>(e.settings.UA=!e.settings.UA,e)))},setIncludedSources(e){t.update((t=>(t.settings.includedSources=e,t)))}}}(r),r.class=te(r),r.spells=function(e){const{characterStore:t}=e;return{get(){return this.getRaw().map((e=>A(e)))},getRaw:()=>t.get().spells,getPreparedSpells(){return this.get().filter((e=>e.prepared))},getSpellsByClass(e){return this.get().filter((t=>t.associatedClass===e))},getSpellsByLevel(e){return this.get().filter((t=>t.level===e))},add(e,r){let s;if(!e)return"noSpell";if(!r)return"noClass";s="string"==typeof e?e=j[e]:e;let i=I(s);i.associatedClass=r,i.prepared=0===s.level,t.get().spells.push(i),t.refresh()},remove:(e,r)=>e?r?("object"==typeof e&&(e=e.hash),void t.update((t=>(t.spells=t.spells.filter((t=>!(t.hash===e&&t.associatedClass===r))),t)))):"noClass":"noSpell",removeSpellsFromClass(e){t.update((t=>(t.spells=t.spells.filter((t=>t.associatedClass!==e)),t)))},toggleSpell(e,t){"string"==typeof e&&(e=j[e]),this.hasSpell(e,t)?this.remove(e,t):this.add(e,t)},hasSpell(e,t){return"object"==typeof e&&(e=e.hash),"object"==typeof t&&(t=t.hash),this.get().filter((r=>r.hash===e&&r.associatedClass===t)).length>0},prepareSpell(e){e.prepared=!0,t.refresh()},unprepareSpell(e){e.prepared=!1,t.refresh()},toggleSpellPrepared(e){let r=this.getRaw().find((t=>t.hash===e.hash));r&&(r.prepared=!r.prepared),t.refresh()},getSpellCastingStatsForSpell(t){const{associatedClass:r}=t,s=u[r];return de(e,s)},getSpellCastingStats:()=>e.class.getSpellCastingClasses().map((t=>de(e,t))),classesSpellCanBeAddedTo(t){let r="string"==typeof t?t=j[t]:t,s=e.class.getSubclasses();return e.class.get().filter(((e,t)=>{let i=s[t],n=e.name.toLowerCase(),a=r.classes.fromClassList.some((e=>e.name.toLowerCase()===n)),o=null!==i&&r.classes.fromSubclass&&r.classes.fromSubclass.some((e=>e.class.name.toLowerCase()===n&&e.subclass.name.toLowerCase()===i.name.toLowerCase()));return a||o}))}}}(r),r.spellSlots=function(e){const{characterStore:t}=e;return{get:()=>t.get().spellSlots,getList(){return Object.entries(this.get()).map((([e,t])=>(t.level=Number(e),t)))},getFilteredList(){return this.getList().filter((t=>t.slots>0||e.spells.getSpellsByLevel(t.level).length>0))},expendSpellSlot(e){this.get()[e].used++,t.refresh()},regainSpellSlot(e){this.get()[e].used--,t.refresh()}}}(r),r.race=function(e){const{characterStore:t}=e;return{get(){let{race:e}=t.get();return c[e]},getFeatures(){return void 0===this.get()?[]:this.get().entries.map((t=>ee(e,t))).map((e=>(e.type="race",e)))},getBonuses(){let e=t.get(),r={str:0,dex:0,con:0,int:0,wis:0,cha:0};if(""!==e.race){let t=this.get();if(void 0!==t&&("ability"in t&&Y(r,t.ability),""!==e.subrace)){let s=t.subraces.filter((t=>t.hash===e.subrace))[0];void 0!==s&&"ability"in s&&Y(r,s.ability)}}return r},getSpeed(){let t=this.get();return void 0===t?0:e.overrides.resolve("speed",t.speed)}}}(r),r.stats=function(e){const{characterStore:t}=e;return{getBaseScores:()=>t.get().abilities,get(){let t=Z(o({},this.getBaseScores()),e.race.getBonuses());return t=Object.fromEntries(Object.entries(t).map((([t,r])=>[t,r=e.overrides.resolve(t,r)]))),t},getModifiers(){let e=Object.entries(this.get());return e=e.map((([e,t])=>[e,p(t)])),Object.fromEntries(e)},getHighestScoreFrom(e=re){let t=this.get();return e.map((e=>t[e])).sort(((e,t)=>t-e))[0]},getHighestModifierFrom(e=re){return p(this.getHighestScoreFrom(e))}}}(r),r.proficiency=(s=r,{get(){let e=s.class.getCharacterLevel(),t=Math.floor((e-1)/4)+2;return s.overrides.resolve("proficiencyModifier",t)},getText(){return F(this.get())}}),r.skills=function(e){const{characterStore:t}=e;return{get(){let e=this.getFullSkills(),t=Object.entries(e);return t=t.map((([e,t])=>[e,t.value])),Object.fromEntries(t)},getFullSkills(){let r=e.stats.getModifiers(),s=e.proficiency.get(),i=t.get().skills,n=Object.entries(i);return n=n.map((([t,i])=>{let n=0;n+=r[v[t].basedOn],i.proficiency===ie.Proficient?n+=s:i.proficiency===ie.Expertise&&(n+=2*s);let a={id:t,name:t,value:e.overrides.resolve(t,n),proficiency:i.proficiency};return t in ce&&(a.name=ce[t]),a.name=C(i.name),[t,a]})),Object.fromEntries(n)},getFullSkillsList(){return Object.values(this.getFullSkills())},setProficiency(e,r){if("object"==typeof e&&(e=e.id),!ue.includes(r))throw new Error("Invalid proficiency value");let s=t.get();s.skills[e].proficiency=r,t.set(s)}}}(r),r.savingThrows=function(e){const{characterStore:t}=e;return{get(){let e=this.getFullSavingThrows();return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,t.value])))},getFullSavingThrows(){let r=e.stats.getModifiers(),s=e.proficiency.get(),i=t.get().savingThrows,n=Object.entries(i);return n=n.map((([t,i])=>{let n=0;n+=r[t],i.proficiency===ie.Proficient&&(n+=s);let a=oe[t],o={id:t,name:t,value:e.overrides.resolve(a,n),proficiency:i.proficiency};return t in b&&(o.name=b[t]),o.name=C(o.name),[t,o]})),Object.fromEntries(n)},getFullSavingThrowsList(){return Object.values(this.getFullSavingThrows())},setProficiency(e,r){if("object"==typeof e&&(e=e.id),!le.includes(r))throw new Error("Invalid proficiency value");let s=t.get();s.savingThrows[e].proficiency=r,t.set(s)}}}(r),r.background=function({characterStore:e}){return{get(){let t=e.get().background;return h[t]}}}(r),r.features=function(e){const{characterStore:t}=e;return{get:()=>t.get().features.map((t=>ee(e,t))),getClassFeatures(){return this.get().filter((e=>"class"===e.type||"subclass"===e.type)).sort(((e,t)=>e.level-t.level))},getRaceFeatures(){return this.get().filter((e=>"race"===e.type))},getSuggestedClassFeatures(){return this.filterFeatures(e.class.getAvailableClassFeatures())},getSuggestedRaceFeatures(){return this.filterFeatures(e.race.getFeatures())},filterFeatures(e){let t=this.get().map((e=>e.hash));return e.filter((e=>!t.includes(e.hash)))},getFeatureHashes(){return this.get().map((e=>e.hash))},addFeature(e){return void 0===e.hash?"notAFeature":this.getFeatureHashes().includes(e.hash)?"featureAlreadyAdded":(t.update((t=>(t.features.push(e),t))),"success")},toggleOptionalFeature(e){let r=t.get();if(r.selectedOptionalFeatures.includes(e)){let t=r.selectedOptionalFeatures.indexOf(e);r.selectedOptionalFeatures.splice(t,1)}else r.selectedOptionalFeatures.push(e);t.set(r)},checkOptionalFeatureSelected:e=>t.get().selectedOptionalFeatures.includes(e),toggleSubFeaturePinned(e){let r=t.get();if(r.pinnedSubFeatures.includes(e)){let t=r.pinnedSubFeatures.indexOf(e);r.pinnedSubFeatures.splice(t,1)}else r.pinnedSubFeatures.push(e);t.set(r)},checkSubFeaturePinned:e=>t.get().pinnedSubFeatures.includes(e),removeFeature(e){let r=e;if("object"==typeof e&&(r=e.hash),!r)return"noFeature";let s=this.get(),i=null;for(let t=0;t<s.length;t++)s[t].hash===r&&(i=t);return null===i?"noFeature":(t.update((e=>(e.features.splice(i,1),e))),"success")}}}(r),r.actions=function(e){return{get(){return[me("Unarmed strike","Melee attack",5,e.stats.getModifiers().str,1+e.stats.get().str),...this.getSpellActions()]},getSpellActions:()=>e.spells.getPreparedSpells().map((e=>me(e.name,`Spell attack • ${e.getLevelString()}`,e.getRangeString(),0,0)))}}(r),r.health=function(e){const{characterStore:t}=e,r={getCurrent:()=>t.get().health.current,getMax:()=>t.get().health.max,getTemp:()=>t.get().health.temp,heal(e=0){let r=this.getCurrent(),s=this.getMax();r+=e,r>s&&(r=s),t.get().health.current=r,t.refresh()},damage(e=0){let r=this.getCurrent(),s=this.getTemp();s>0&&((e-=s)<0?(s=Math.abs(e),e=0):s=0),r-=e,r<0&&(r=0),t.get().health.current=r,t.get().health.temp=s,t.refresh()}};let s=!1;return t.subscribe((e=>{if(s)return void(s=!1);let{current:r,max:i,temp:n}=e.health;i<0&&(i=0),n<0&&(n=0),r<0&&(r=0),r>i&&(r=i),null===r&&(r=0),e.health.current=r,e.health.max=i,e.health.temp=n,t.refresh(),s=!0})),r}(r),r.includedData=function(e){return{getRaces:()=>ve(c,e.settings.get()),getClasses:()=>ve(u,e.settings.get()),getBackgrounds:()=>ve(h,e.settings.get()),getSpells:()=>ve(j,e.settings.get()),getItems:()=>ve(S,e.settings.get()),filterArray:(t=[])=>t.filter((t=>ye(t,e.settings.get())))}}(r),r.overrides=function(e){let{characterStore:t}=e;return{get:()=>t.get().overrides,getList(){return Object.entries(this.get()).map((([e,t])=>l(o({},t),{key:e})))},getCategories(){let e=[];return this.getList().forEach((t=>{t.categories.forEach((t=>{e.includes(t)||e.push(t)}))})),e},resolve(e,t){let r=this.get()[e];return void 0===r||(r.overrideEnabled&&(t=r.override),r.bonusEnabled&&(t+=r.bonus)),t}}}(r),r.proficiencies=function(e){const{characterStore:t}=e;return{add(e,r){let s=!1;if(void 0!==Ce[e]&&(e=Ce[e],s=!0),!Object.values(Ce).includes(e))throw new Error("Invalid proficiency type");let i={type:e,name:r,hash:null,custom:s},n=Object.values(E).find((e=>e.name.toLowerCase()===r.toLowerCase()));void 0!==n&&(i.hash=n.hash),t.update((e=>(e.proficiencies.push(i),e)))},remove(e){"object"==typeof e&&(e=e.name);let r=this.get().findIndex((t=>t.name===e));r>=0&&t.update((e=>(e.proficiencies.splice(r,1),e)))},get:()=>t.get().proficiencies.map(be),getCategorized(){let e=this.get();return{armor:e.filter((e=>"armor"===e.type)),weapon:e.filter((e=>"weapon"===e.type)),tool:e.filter((e=>"tools"===e.type)),language:e.filter((e=>"language"===e.type))}},isProficientIn(e){return void 0!==this.get().find((t=>t.name===e))}}}(r),r}Fe.set(1.1,(e=>{let t={str:se("Strength ability score",["Ability score"]),dex:se("Dexterity ability score",["Ability score"]),con:se("Constitution ability score",["Ability score"]),int:se("Intelligence ability score",["Ability score"]),wis:se("Wisdom ability score",["Ability score"]),cha:se("Charisma ability score",["Ability score"])};e.overrides=o(o({},e.overrides),t)})),Fe.set(1.2,(e=>{e.attunedItems=[]}));function xe(e){let t,r,s,i,n,a,o;const l=e[3].default,c=R(l,e,e[2],null);return{c(){t=U("div"),r=U("div"),c&&c.c(),s=$(),i=U("span"),n=D(e[0]),this.h()},l(a){t=B(a,"DIV",{class:!0});var o=z(t);r=B(o,"DIV",{class:!0});var l=z(r);c&&c.l(l),l.forEach(H),s=N(o),i=B(o,"SPAN",{class:!0});var u=z(i);n=q(u,e[0]),u.forEach(H),o.forEach(H),this.h()},h(){V(r,"class","inner svelte-pg6zmy"),V(i,"class","svelte-pg6zmy"),V(t,"class",a="container "+(e[1]?"autoSize":"")+" svelte-pg6zmy")},m(e,a){_(e,t,a),G(t,r),c&&c.m(r,null),G(t,s),G(t,i),G(i,n),o=!0},p(e,[r]){c&&c.p&&(!o||4&r)&&J(c,l,e,e[2],r,null,null),(!o||1&r)&&K(n,e[0]),(!o||2&r&&a!==(a="container "+(e[1]?"autoSize":"")+" svelte-pg6zmy"))&&V(t,"class",a)},i(e){o||(Q(c,e),o=!0)},o(e){X(c,e),o=!1},d(e){e&&H(t),c&&c.d(e)}}}function Ee(e,t,r){let{$$slots:s={},$$scope:i}=t;var{text:n=""}=t,{autoSize:a=!1}=t;return e.$$set=e=>{"text"in e&&r(0,n=e.text),"autoSize"in e&&r(1,a=e.autoSize),"$$scope"in e&&r(2,i=e.$$scope)},[n,a,i,s]}class Te extends k{constructor(e){super(),W(this,e,Ee,xe,M,{text:0,autoSize:1})}}export{Te as C,ie as P,Oe as a,Ae as g,je as n};
